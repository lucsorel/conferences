:revealjs_customtheme: assets/beige-stylesheet.css
:revealjs_progress: true
:revealjs_slideNumber: true
:source-highlighter: highlightjs
:icons: font
:toc:

= M√©thodes magiques, m√©taclasses, DSL de parcours de donn√©es

== D√©couverte des m√©thodes magiques et des m√©taclasses pour construire une syntaxe de parcours de donn√©es

image:assets/2025.10.15-python_rennes-a_kind_of_magic.png[banni√®re - a kind of magic,60%]

[.medium-text]
*Luc Sorel-Giffo* -- mercredi 15 octobre 2025 -- Hellowork

[.small-text]
https://floss.social/@lucsorelgiffo[@lucsorelgiffo@floss.social] (tech-lead full-stack chez https://www.seeyousun.fr[See you sun] üåû‚ö°)

=== Au programme

Retour d'exp√©rience sur l'√©laboration d'une syntaxe de parcours de donn√©es : https://github.com/lucsorel/datawalk[github.com/lucsorel/datawalk] (TODO publier sur pypi)

* d√©couverte non-ma√Ætris√©e de sujets "bas niveau"
** m√©thodes magiques
** m√©taclasse
* d√©tourer ces notions pour vous donner des id√©es

== Pourquoi ?

[.medium-text]
G√©n√©ration d'un rapport de synth√®se des ratios de d√©formation √† partir d'une application de g√©nie civil produisant un dictionnaire arborescent de r√©sultats de calcul dont la structure est amen√©e √† √©voluer vite.

[source,javascript]
----
{
    √©l√©ment: {
        type: "",
        mat√©riau: {...},
        forme: {...},
        v√©rifications: [
            {contraintes: [...], d√©formations: {cisaillement: 0.15, torsion: 0,32}},
            // ...
        ]
    },
    // ...
}
----


[source,python]
----
v√©rifications = results['poteau']['v√©rifications']
v√©rification = next(
    v√©rification for v√©rification in v√©rifications
    if "temp√™te" in verification
) 
cisaillement = v√©rification['d√©formations']['cisaillement']
----

=== Motivations

* √©laborer une syntaxe expressive pour r√©cup√©rer les donn√©es ("structure arborescente")
* d√©coreller l'algorithmie structurant le rapport de la recherche de donn√©es ("structure √©volutive")
** -> message d'erreur expressif si le chemin d'acc√®s au donn√©es casse

=== Inspiration : pathlib.Path

[source,python]
----
from os import path
from pathlib import Path

schemas_folder = path.join(path.dirname(path.dirname(__file__)), 'schemas')
if path.isdir(schemas_folder):
    print(f'{schemas_folder} exists')

schemas_path = Path(__file__).parent.parent / 'schemas'
if schemas_path.is_dir():
    print(f'{schemas_folder} exists')
----

Division d'une instance de Path par une cha√Æne de caract√®res... ü§î

== M√©thodes sp√©ciales

Vous en √©crivez d√©j√† r√©guli√®rement, vous ne les appelez (presque üòè) jamais vous-m√™me.

=== Exemple : +__init__+

[source,python]
----
class Person:
  def __init__(self, fullname: str):
    self.fullname = fullname

class Learner(Person):
  def __init__(self, fullname: str, classes: list[str]):
    super().__init__(fullname)
    self.classes = classes
----

- operators and magic methods: https://docs.python.org/3/reference/datamodel.html#emulating-numeric-types
- operator precedence: https://docs.python.org/3/reference/expressions.html#operator-precedence
